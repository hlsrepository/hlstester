# HLSTester: Efficient Testing of Behavioral Discrepancies with LLMs for High-Level Synthesis

## Introduction
HLSTester is an advanced testing framework designed to detect behavioral discrepancies between original C/C++ programs and their RTL implementations synthesized via High-Level Synthesis (HLS). Leveraging Large Language Models (LLMs), HLSTester automates testbench modifications, runtime instrumentation, spectra monitoring, intelligent test input generation, and redundancy-aware filtering, reducing manual efforts and accelerating the HLS testing workflow.

## Key Features
- **Testbench Modification**: Utilizes LLMs guided by external rule libraries to convert traditional C/C++ testbenches into HLS-compatible versions, addressing typical incompatibilities with hardware synthesis.
- **Code Instrumentation**: Employs backward slicing techniques combined with LLM semantic understanding to pinpoint and instrument key variables.
- **Runtime Spectra Monitoring**: Automatically tracks runtime behaviors of key variables to analyze discrepancies, including overflow, truncation, memory access issues, etc.
- **Multi-Dimensional Guided Test Input Generation**:
  - **Dynamic Mutation**: Adapts mutation strategies dynamically based on runtime feedback, increasing the likelihood of revealing platform-specific discrepancies.
  - **LLM-Guided Input Generation**: Leverages progressive reasoning chains from LLMs to generate insightful test inputs.
- **Redundancy-Aware Filtering**: Avoids redundant hardware simulations by tracking and filtering repetitive test inputs.

## Setup
Ensure the following scripts and directories are correctly set up within your local environment:

## Scripts Description
- `compile.py`: Compiles and synthesizes the HLS program using the Vitis HLS tool.
- `emb.py`: Matches compiler error logs to external HLS rule templates using semantic embeddings.
- `tb_gene.py`: Uses LLM to modify original C/C++ testbenches to HLS-compatible versions.
- `run.py`: Calculates simulation pass rates across test instances.
- `instrument.py`: Instruments critical variables for runtime spectra collection.
- `mutate.py`: Dynamically generates diverse test inputs based on adaptive mutation strategies.
- `testing.py`: Orchestrates the comprehensive testing workflow including:
  - Semantic code analysis
  - Runtime spectra monitoring
  - Spectra feedback-guided mutations
  - LLM-driven test input generation
  - Discrepancy detection and reporting
- `raf.py`: Implements redundancy-aware filtering to skip repetitive hardware simulations.

### Directory Structure
Set up the following directories in your environment:
- `vitis_bin`: Path to the Vitis HLS tool (e.g., `/tools/xilinx/Vitis/2024.1/bin`)
- `co_base_dir`: Path to original C/C++ programs for CPU execution
- `hlso_base_dir`: Path to HLS-compatible programs for RTL generation
- `input_file_path`: Directory to store generated test inputs
- `cpp_output_dir`: Directory for CPU-based runtime spectra
- `hls_output_dir`: Directory for FPGA-based RTL spectra
- `diff_dir`: Directory to store differences between CPU and FPGA outcomes
- `check_dir`: Directory for runtime parameters used in dynamic mutation
- `gt_dir`: Directory to store GPT interaction history

### Compiler and Environment Requirements
- **Python 3.8**
- **Vitis HLS 2024.1**
- **GPT model access via OpenAI APIs**
- **GCC/G++ Compiler** 

## Conclusion
In this paper, we propose HLSTester, an LLM-aided testing framework designed to efficiently detect behavioral discrepancies in HLS. Existing C/C++ testbenches are used to guide the LLM in modifying them into HLS-compatible versions, with efficient test inputs generated by dynamic mutation with an LLM-based progressive reasoning chain to increase the likelihood of revealing behavioral discrepancies. A backward slicing technique is employed to pinpoint the key variables, and a monitoring script is developed to record their runtime spectra for detailed discrepancy analysis. Experimental results show that the proposed HLSTester significantly accelerates the testing workflow and achieves high simulation pass rates.
